<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<title>任务设置</title>
<link rel="stylesheet" href="/css/index.css" type="text/css">
<script type="text/javascript" src="/js/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="/js/jquery.SuperSlide.2.1.3.js"></script>
<script type="text/javascript" src="/js/layui.js"></script>
<link rel="stylesheet" href="/css/layui.css">
</head>
<body>
   <div class="topbanner"><img src="/img/banner.png" alt=""></div>
   <div class="main">
  		<h3 class="New_h3">统计结果</h3>
   		<div class="New_jieguo">
  			<div class="LeftUp">
  				<!--学部下拉框选择-->
  				<div class="xuebu">
					<label>学部：
						<select id="XB" name="sel1" onChange="XueBuChange(this.value)">
							<option>=请选择=</option>
						</select>
					</label>
				</div>
				<!--年级下拉框选择-->
				<div class="xuebu">
					<label>年级：
						<select id="grade" name="sel1" onChange="GradeChange(this.value)">
							<option>=请选择=</option>
						</select>
					</label>
				</div>
				<!--班级下拉框选择-->
				<div class="xuebu">
					<label>班级：
						<select id="clazz" name="sel1" onChange="ClazzChange(this.value)">
							<option>=请选择=</option>
						</select>
					</label>
				</div>
  			</div>
  			<div class="LeftDown">
  				<h3 id="JG"></h3>
  				<ul>
  					<li><span id="JSL">0%</span>近视率</li>
  					<li><span>优秀</span>用眼行为评级</li>
  				</ul>
  			</div>
  		</div>
   </div>
   <h3 class="New_h3">奖励详情</h3>
   <div class="main renwuBox" style="background:#f9ae40;padding:8px;border-radius:10px;">
   		<div class="hd" id="New_hd">
   		</div>
   		<div class="bd" id="New_bd">
			<form id="signupForm">
   			<div class="txt">
				<p>任务时间：<span id="span1"></span></p>
				<p>平均评级：<span id="span2"></span></p>
   				<dl>
   					<dt>任务详情：</dt>
   					<dd>

						<ul>
							<li><em>时长：</em>
								<select name="taskTime" onchange="setTaskTime(this.value)">
									<option value="0">=请选择=</option>
									<option value="1">一周</option>
									<option value="2">10天</option>
									<option value="3">15天</option>
									<option value="4">20天</option>
								</select>
							</li>
							<li><em>健康用眼评级：</em>
								<select name="eyeRate" onchange="setEyeRate(this.value)">
									<option value="0">=请选择=</option>
									<option value="1">优秀</option>
									<option value="2">良好</option>
									<option value="3">差</option>
									<option value="4">极差</option>
								</select>
							</li>
							<li><em>平均单次阅读时长：</em>
								<select name="avgRead">
									<option value="0">=请选择=</option>
									<option value="1">优秀</option>
									<option value="2">良好</option>
									<option value="3">差</option>
									<option value="4">极差</option>
								</select>
							</li>
							<li><em>平均户外时长：</em>
								<select name="avgOut" >
									<option value="0">=请选择=</option>
									<option value="1">优秀</option>
									<option value="2">良好</option>
									<option value="3">差</option>
									<option value="3">极差</option>
								</select>
							</li>
							<li><em>平均阅读距离：</em>
								<select name="avgReadDistance">
									<option value="0">=请选择=</option>
									<option value="1">优秀</option>
									<option value="2">良好</option>
									<option value="3">差</option>
									<option value="4">极差</option>
								</select>
							</li>
							<li><em>平均阅读光照：</em>
								<select name="avgLight">
									<option value="0">=请选择=</option>
									<option value="1">优秀</option>
									<option value="2">良好</option>
									<option value="3">差</option>
									<option value="4">极差</option>
								</select>
							</li>
							<li><em>平均单次看手机时长：</em>
								<select name="avgLookPhone">
									<option value="0">=请选择=</option>
									<option value="1">优秀</option>
									<option value="2">良好</option>
									<option value="3">差</option>
									<option value="4">极差</option>
								</select>
							</li>
							<li><em>平均单次看电脑电视时长：</em>
								<select name="avgLookTv">
									<option value="0">=请选择=</option>
									<option value="1">优秀</option>
									<option value="2">良好</option>
									<option value="3">差</option>
									<option value="4">极差</option>
								</select>
							</li>
							<li><em>平均坐姿倾斜度：</em>
								<select name="avgSitTilt" >
									<option value="0">=请选择=</option>
									<option value="1">优秀</option>
									<option value="2">良好</option>
									<option value="3">差</option>
									<option value="4">极差</option>
								</select>
							</li>
							<li><em>有效使用监护仪总时长：</em>
								<select name="effectiveUseTime" >
									<option value="0">=请选择=</option>
									<option value="1">优秀</option>
									<option value="2">良好</option>
									<option value="3">差</option>
									<option value="4">极差</option>
								</select>
							</li>
						</ul>

  					</dd>
   				</dl>
   				<input type="button" value="执行任务" onclick="save()">
   			</div>
			</form>
   		</div>
   </div>
</body>
</html>
<script type="text/javascript" th:inline="javascript">

	var school = [[${school}]];
	var checkType = [[${checkType}]];
	var CityName = [[${CityName}]];
	var AreaName = [[${AreaName}]];

	var XueBu='';
	var Grade='';
	var Clazz='';
	var idCards=[];
	$.ajax({
		cache: true,
		type: "GET",
		async: false,
		url: '/Newhuyan/XueBu?school='+school+'&CityName='+CityName+'&AreaName='+AreaName+'&checkType='+checkType,
		error: function (request) {
			parent.layer.alert("网络超时");
		},
		success: function (data) {
			var html=`<option>=请选择=</option>`;
			for (let i = 0; i < data.length; i++) {
				html+=`<option value=`+data[i]+`>`+data[i]+`</option>`
			}

			$("#XB").html(html)
		}
	})
	var XueBuChange = function (xuebu){
		if ('=请选择='==xuebu){
			$("#grade").html(`<option>=请选择=</option>`);
			$("#clazz").html(`<option>=请选择=</option>`);
			$("#JSL").text(`0%`);
			$("#JG").text(``);
			XueBu='';
			Grade='';
			Clazz='';
		}
		if ('=请选择='!=xuebu){
			XueBu=xuebu;
			$.ajax({
				cache: true,
				type: "GET",
				async: false,
				url: '/Newhuyan/Grade?school='+school+'&CityName='+CityName+'&AreaName='+AreaName+'&checkType='+checkType+'&xuebu='+xuebu,
				error: function (request) {
					parent.layer.alert("网络超时");
				},
				success: function (data) {
					var html=`<option>=请选择=</option>`;
					for (let i = 0; i < data.length; i++) {
						html+=`<option value=`+data[i]+`>`+data[i]+`</option>`
					}
					$("#grade").html(html)
				}
			})
		}
	}


	var GradeChange = function (grade){
		if ('=请选择='==grade){
			$("#clazz").html(`<option>=请选择=</option>`);
			$("#JSL").text(`0%`);
			$("#JG").text(``);

			Grade='';
			Clazz='';
		}
		if ('=请选择='!=grade){
			Grade=grade;
			$.ajax({
				cache: true,
				type: "GET",
				async: false,
				url: '/Newhuyan/Clazz?school='+school+'&CityName='+CityName+'&AreaName='+AreaName+'&checkType='+checkType+'&xuebu='+XueBu+'&grade='+grade,
				error: function (request) {
					parent.layer.alert("网络超时");
				},
				success: function (data) {
					var html=`<option>=请选择=</option>`;
					for (let i = 0; i < data.length; i++) {
						html+=`<option value=`+data[i]+`>`+data[i]+`</option>`
					}
					$("#clazz").html(html)
				}
			})
		}
	}


	var ClazzChange = function (clazz){
		if ('=请选择='==clazz){
			$("#JG").html(``);
			$("#JSL").text(`0%`);
			$("#JG").text(``);
			Clazz='';
		}
		if ('=请选择='!=clazz){
			$("#JG").text($("#XB").val()+$("#grade").val()+$("#clazz").val()+'统计结果');
			Clazz=clazz;
			$.ajax({
				cache: true,
				type: "GET",
				async: false,
				url: '/Newhuyan/ClazzJSL?school='+school+'&CityName='+CityName+'&AreaName='+AreaName+'&checkType='+checkType+'&xuebu='+XueBu+'&grade='+Grade+'&clazz='+clazz,
				error: function (request) {
					parent.layer.alert("网络超时");
				},
				success: function (data) {
					$("#JSL").text(data+'%')
					getClazzIdCards();
				}
			})
		}
	}

	var getClazzIdCards = function (){
			$("#JG").text($("#XB").val()+$("#grade").val()+$("#clazz").val()+'统计结果');
			$.ajax({
				cache: true,
				type: "GET",
				async: false,
				url: '/Newhuyan/GetClazzIdCards?school='+school+'&CityName='+CityName+'&AreaName='+AreaName+'&checkType='+checkType+'&xuebu='+XueBu+'&grade='+Grade+'&clazz='+Clazz,
				error: function (request) {
					parent.layer.alert("网络超时");
				},
				success: function (data) {
					idCards=data;
				}
			})
	}

	var initTask = function () {
	   $.ajax({
		  type:'get',
		  url:'http://localhost:8087/api/gift/listPc',
          async : false,
          dataType : "jsonp",
          jsonp:"callback",
          success : function(data) {
             console.log(data.data,"data")
			 result = data.data
			 var html = ''
			 html+='<ul>'
			 for(var i= 0;i<result.length;i++){
			    html+='<li><input type="hidden" value="'+result[i].id+'"><img src="'+result[i].coverImg+'" alt=""/><p>'+result[i].giftName+'</p></li>'
			 }
			 html+='</ul>'
			 $('#New_hd').html(html)
          },
          error : function() {
             alert('fail');
          }
	   })
    }


	$(function () {
       initTask();
       setInterval("loadslide()", 1000);
    })
	function loadslide(){
       jQuery(".renwuBox").slide({trigger:"click"});
	}

	function setTaskTime(value) {
	   if(value!=null && value>0){
			if(value == 1){
			   $('#span1').text("一周")
			}else if(value == 2){
			   $('#span1').text("10天")
			}else if(value == 3){
			   $('#span1').text("15天")
			}else if(value == 4){
			   $('#span1').text("20天")
			}
	   }
    }

    function setEyeRate(value) {
       if(value!=null && value>0){
          if(value == 1){
             $('#span2').text("优秀")
          }else if(value == 2){
             $('#span2').text("良好")
          }else if(value == 3){
             $('#span2').text("差")
          }else if(value == 4){
             $('#span2').text("极差")
          }
       }
    }

    function save() {
	   if(idCards.length ==0){
          alert("请选择任务班级");
	      return;
	   }
	   if($("select[name='taskTime']").val() <=0){
          alert("请选择任务时长");
          return;
	   }
       if($("select[name='eyeRate']").val() <=0){
          alert("请选择用眼评级");
          return;
       }
       if($("select[name='avgRead']").val() <=0 ){
          alert("请选择平均单次阅读时长");
          return;
       }
       if($("select[name='avgReadDistance']").val() <=0 ){
          alert("请选择平均阅读距离");
          return;
       }
       if($("select[name='avgLight']").val() <=0 ){
          alert("请选择平均阅读光照");
          return;
       }
       if($("select[name='avgLookPhone']").val() <=0 ){
          alert("请选择平均单次看手机时长");
          return;
       }
       if($("select[name='avgLookTv']").val() <=0 ){
          alert("请选择平均单次看电脑电视时长");
          return;
       }
       if($("select[name='avgSitTilt']").val() <=0 ){
          alert("请选择平均坐姿倾斜度");
          return;
       }
       if($("select[name='effectiveUseTime']").val() <=0 ){
          alert("请选择有效使用监护仪总时长");
          return;
       }

       var signupFormData=$('#signupForm').serialize();
       var idCards11=JSON.stringify(idCards);

	   var giftId = $("#New_hd ul").find(".on").children("input").val()
	   alert("请求中，请稍等")
       $.ajax({
          cache: true,
          type: "get",
          url: "http://localhost:8087/api/gift/customTaskPc",
          data: signupFormData+"&idCards="+idCards11+"&giftId="+giftId,// 你的formid
          dataType : "jsonp",
          jsonp:"callback",
          async: false,
          success: function (data) {
			if(data.havedTaskuserName.length >0){
			   alert("该班级学生有进行中的班级任务")
			}else{
               alert("已成功发布任务")
			}
          },
		  error: function (request) {
          	alert("Connection error");
		  },
       });

    }
</script>


